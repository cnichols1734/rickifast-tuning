{% extends "base.html" %}
{% block title %}Dashboard — AutoCRM{% endblock %}

{% block content %}
<div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6">
    <h1 class="text-2xl font-semibold text-gray-900">Dashboard</h1>
    <div class="mt-3 sm:mt-0 flex gap-2">
        <a href="{{ url_for('clients.create') }}" class="inline-flex items-center px-3 py-1.5 text-sm font-medium rounded-md bg-blue-600 text-white hover:bg-blue-700">New Client</a>
        <a href="{{ url_for('invoices.create') }}" class="inline-flex items-center px-3 py-1.5 text-sm font-medium rounded-md border border-gray-300 bg-white text-gray-700 hover:bg-gray-50">New Invoice</a>
    </div>
</div>

<!-- Stat cards -->
<div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
    <div class="bg-white rounded-lg border border-gray-200 shadow-sm p-5">
        <p class="text-sm text-gray-500">Total Clients</p>
        <p class="text-2xl font-semibold mt-1">{{ total_clients }}</p>
    </div>
    <div class="bg-white rounded-lg border border-gray-200 shadow-sm p-5">
        <p class="text-sm text-gray-500">Outstanding ({{ outstanding_count }})</p>
        <p class="text-2xl font-semibold mt-1">${{ '{:,.2f}'.format(outstanding_total) }}</p>
    </div>
    <div class="bg-white rounded-lg border border-gray-200 shadow-sm p-5">
        <p class="text-sm text-gray-500">This Month</p>
        <p class="text-2xl font-semibold mt-1">${{ '{:,.2f}'.format(monthly_revenue) }}</p>
    </div>
    <div class="bg-white rounded-lg border border-gray-200 shadow-sm p-5">
        <p class="text-sm text-gray-500">All-Time Revenue</p>
        <p class="text-2xl font-semibold mt-1">${{ '{:,.2f}'.format(all_time_revenue) }}</p>
    </div>
</div>

<!-- Recent activity -->
<div class="grid lg:grid-cols-3 gap-6">
    <!-- Recent Invoices -->
    <div class="bg-white rounded-lg border border-gray-200 shadow-sm">
        <div class="px-5 py-4 border-b border-gray-100">
            <h2 class="text-sm font-semibold text-gray-900">Recent Invoices</h2>
        </div>
        <div class="divide-y divide-gray-100">
            {% for inv in recent_invoices %}
            <a href="{{ url_for('invoices.view', id=inv.id) }}" class="block px-5 py-3 hover:bg-gray-50">
                <div class="flex justify-between items-center">
                    <div>
                        <p class="text-sm font-medium text-gray-900">{{ inv.invoice_number }}</p>
                        <p class="text-xs text-gray-500">{{ inv.client.full_name }}</p>
                    </div>
                    <div class="text-right">
                        <p class="text-sm font-medium">${{ '{:,.2f}'.format(inv.calculate_total()) }}</p>
                        {% set s = inv.get_status() %}
                        <span class="inline-block mt-0.5 px-2 py-0.5 text-xs font-medium rounded-full
                            {% if s == 'draft' %}bg-gray-100 text-gray-600
                            {% elif s == 'sent' %}bg-blue-100 text-blue-700
                            {% elif s == 'partial' %}bg-yellow-100 text-yellow-700
                            {% elif s == 'paid' %}bg-green-100 text-green-700
                            {% elif s == 'overdue' %}bg-red-100 text-red-700
                            {% endif %}">{{ s }}</span>
                    </div>
                </div>
            </a>
            {% else %}
            <p class="px-5 py-4 text-sm text-gray-400">No invoices yet.</p>
            {% endfor %}
        </div>
    </div>

    <!-- Recent Clients -->
    <div class="bg-white rounded-lg border border-gray-200 shadow-sm">
        <div class="px-5 py-4 border-b border-gray-100">
            <h2 class="text-sm font-semibold text-gray-900">Recent Clients</h2>
        </div>
        <div class="divide-y divide-gray-100">
            {% for c in recent_clients %}
            <a href="{{ url_for('clients.view', id=c.id) }}" class="block px-5 py-3 hover:bg-gray-50">
                <p class="text-sm font-medium text-gray-900">{{ c.full_name }}</p>
                <p class="text-xs text-gray-500">{{ c.vehicle_display }}</p>
            </a>
            {% else %}
            <p class="px-5 py-4 text-sm text-gray-400">No clients yet.</p>
            {% endfor %}
        </div>
    </div>

    <!-- Recent Payments -->
    <div class="bg-white rounded-lg border border-gray-200 shadow-sm">
        <div class="px-5 py-4 border-b border-gray-100">
            <h2 class="text-sm font-semibold text-gray-900">Recent Payments</h2>
        </div>
        <div class="divide-y divide-gray-100">
            {% for p in recent_payments %}
            <a href="{{ url_for('invoices.view', id=p.invoice_id) }}" class="block px-5 py-3 hover:bg-gray-50">
                <div class="flex justify-between items-center">
                    <div>
                        <p class="text-sm font-medium text-gray-900">${{ '{:,.2f}'.format(p.amount) }}</p>
                        <p class="text-xs text-gray-500">{{ p.invoice.invoice_number }} · {{ p.method }}</p>
                    </div>
                    <p class="text-xs text-gray-400">{{ p.payment_date.strftime('%b %d') if p.payment_date else '' }}</p>
                </div>
            </a>
            {% else %}
            <p class="px-5 py-4 text-sm text-gray-400">No payments yet.</p>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}
