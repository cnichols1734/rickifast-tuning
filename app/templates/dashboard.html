{% extends "base.html" %}
{% block title %}Dashboard — Rickifast Tuning LLC{% endblock %}

{% block content %}
<div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-8">
    <div>
        <h1 class="text-2xl font-bold text-slate-900">Dashboard</h1>
        <p class="text-sm text-slate-500 mt-1">Overview of your business performance.</p>
    </div>
    <div class="mt-4 sm:mt-0 flex gap-3">
        <a href="{{ url_for('clients.create') }}" class="inline-flex items-center px-4 py-2 text-sm font-medium rounded-md bg-slate-900 text-white hover:bg-slate-800 transition-colors shadow-xs">New Client</a>
        <a href="{{ url_for('invoices.create') }}" class="inline-flex items-center px-4 py-2 text-sm font-medium rounded-md border border-slate-300 bg-white text-slate-700 hover:bg-slate-50 transition-colors shadow-xs">New Invoice</a>
    </div>
</div>

<!-- Stat cards -->
<div class="grid grid-cols-2 lg:grid-cols-4 gap-6 mb-10">
    <div class="bg-white rounded-lg border border-slate-200 p-6">
        <p class="text-sm font-medium text-slate-500">Total Clients</p>
        <p class="text-3xl font-bold text-slate-900 mt-2">{{ total_clients }}</p>
    </div>
    <div class="bg-white rounded-lg border border-slate-200 p-6">
        <p class="text-sm font-medium text-slate-500">Outstanding ({{ outstanding_count }})</p>
        <p class="text-3xl font-bold text-slate-900 mt-2">${{ '{:,.2f}'.format(outstanding_total) }}</p>
    </div>
    <div class="bg-white rounded-lg border border-slate-200 p-6">
        <p class="text-sm font-medium text-slate-500">This Month</p>
        <p class="text-3xl font-bold text-slate-900 mt-2">${{ '{:,.2f}'.format(monthly_revenue) }}</p>
    </div>
    <div class="bg-white rounded-lg border border-slate-200 p-6">
        <p class="text-sm font-medium text-slate-500">All-Time Revenue</p>
        <p class="text-3xl font-bold text-slate-900 mt-2">${{ '{:,.2f}'.format(all_time_revenue) }}</p>
    </div>
</div>

<!-- Recent activity -->
<div class="grid lg:grid-cols-3 gap-8">
    <!-- Recent Invoices -->
    <div class="bg-white rounded-lg border border-slate-200 overflow-hidden">
        <div class="px-6 py-4 border-b border-slate-100 bg-slate-50/50">
            <h2 class="text-sm font-semibold text-slate-900 uppercase tracking-wider">Recent Invoices</h2>
        </div>
        <div class="divide-y divide-slate-100">
            {% for inv in recent_invoices %}
            <a href="{{ url_for('invoices.view', id=inv.id) }}" class="block px-6 py-4 hover:bg-slate-50 transition-colors">
                <div class="flex justify-between items-center">
                    <div>
                        <p class="text-sm font-semibold text-slate-900">{{ inv.invoice_number }}</p>
                        <p class="text-sm text-slate-500 mt-0.5">{{ inv.client.full_name }}</p>
                    </div>
                    <div class="text-right">
                        <p class="text-sm font-bold text-slate-900">${{ '{:,.2f}'.format(inv.calculate_total()) }}</p>
                        {% set s = inv.get_status() %}
                        <span class="inline-flex items-center mt-1 px-2 py-0.5 text-xs font-medium rounded-full
                            {% if s == 'draft' %}bg-slate-100 text-slate-600 border border-slate-200
                            {% elif s == 'sent' %}bg-blue-50 text-blue-700 border border-blue-200
                            {% elif s == 'partial' %}bg-amber-50 text-amber-700 border border-amber-200
                            {% elif s == 'paid' %}bg-emerald-50 text-emerald-700 border border-emerald-200
                            {% elif s == 'overdue' %}bg-red-50 text-red-700 border border-red-200
                            {% endif %}">{{ s|capitalize }}</span>
                    </div>
                </div>
            </a>
            {% else %}
            <p class="px-6 py-8 text-sm text-slate-400 text-center">No invoices yet.</p>
            {% endfor %}
        </div>
    </div>

    <!-- Recent Clients -->
    <div class="bg-white rounded-lg border border-slate-200 overflow-hidden">
        <div class="px-6 py-4 border-b border-slate-100 bg-slate-50/50">
            <h2 class="text-sm font-semibold text-slate-900 uppercase tracking-wider">Recent Clients</h2>
        </div>
        <div class="divide-y divide-slate-100">
            {% for c in recent_clients %}
            <a href="{{ url_for('clients.view', id=c.id) }}" class="block px-6 py-4 hover:bg-slate-50 transition-colors">
                <p class="text-sm font-semibold text-slate-900">{{ c.full_name }}</p>
                <p class="text-sm text-slate-500 mt-0.5">{{ c.vehicle_display }}</p>
            </a>
            {% else %}
            <p class="px-6 py-8 text-sm text-slate-400 text-center">No clients yet.</p>
            {% endfor %}
        </div>
    </div>

    <!-- Recent Payments -->
    <div class="bg-white rounded-lg border border-slate-200 overflow-hidden">
        <div class="px-6 py-4 border-b border-slate-100 bg-slate-50/50">
            <h2 class="text-sm font-semibold text-slate-900 uppercase tracking-wider">Recent Payments</h2>
        </div>
        <div class="divide-y divide-slate-100">
            {% for p in recent_payments %}
            <a href="{{ url_for('invoices.view', id=p.invoice_id) }}" class="block px-6 py-4 hover:bg-slate-50 transition-colors">
                <div class="flex justify-between items-center">
                    <div>
                        <p class="text-sm font-bold text-slate-900">${{ '{:,.2f}'.format(p.amount) }}</p>
                        <p class="text-sm text-slate-500 mt-0.5">{{ p.invoice.invoice_number }} · {{ p.method }}</p>
                    </div>
                    <p class="text-xs text-slate-400 font-medium">{{ p.payment_date.strftime('%b %d') if p.payment_date else '' }}</p>
                </div>
            </a>
            {% else %}
            <p class="px-5 py-4 text-sm text-gray-400">No payments yet.</p>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}
